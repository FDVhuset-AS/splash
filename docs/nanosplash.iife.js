var T=Object.defineProperty,b=Object.defineProperties;var y=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var S=(a,o,c)=>o in a?T(a,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[o]=c,w=(a,o)=>{for(var c in o||(o={}))x.call(o,c)&&S(a,c,o[c]);if(I)for(var c of I(o))C.call(o,c)&&S(a,c,o[c]);return a},p=(a,o)=>b(a,y(o));(function(){"use strict";const a=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};var o="";function c(r){return document.querySelector(r)}function v(r,e,t=!1){r&&e&&(e.hasChildNodes()&&t?e.insertBefore(r,e.firstChild):e.appendChild(r))}const m=r=>document.createElement(r);function d(r,...e){r.classList.add(...e)}function E(r,e,t){r.setAttribute(e,t)}class f{static destinationToNode(e){if(typeof e=="string"){const t=c(e);if(!t)throw new Error(`No match with ${e}`);return t}else if(e instanceof Node)return e;throw new Error("Destination argument must string or Node")}static createContextualApiObject(e){const t={getId:()=>e.getId(),remove:()=>e.delete(),moveTo:n=>e.moveTo(n),getText:()=>e.getText(),setText:n=>e.setText(n),getImgSrc:()=>e.getImgSrc(),setImgSrc:n=>e.setImgSrc(n)};return p(w({},t),{inside:n=>(e.moveTo(n),t)})}}class u{constructor(e,t,n){var s;this.nsRootElement=m("div"),this.nsTextElement=m("div"),this.nsWindowElement=m("div"),this.nsWrapperElement=m("div"),this.nsContentElement=m("div"),this.nsImageElement=m("img"),this.id=Math.random().toString(36).substring(2),this.nsInstance=e,this.nsTextElement.innerText=t,this.imgSrc=n,this.nsImageElement.src=(s=this.imgSrc)!=null?s:"",this.nsImageElement.alt=g.APP_NAME,this.assembleNSComponent(),this.setImgSrc(n)}assignCSSClasses(){d(this.nsContentElement,"ns-container"),d(this.nsWrapperElement,"ns-blur"),d(this.nsImageElement,"ns-img"),d(this.nsTextElement,"ns-text"),d(this.nsWindowElement,"ns","ns-window"),d(this.nsRootElement,"ns-wrapper")}assembleElementStructure(){this.nsContentElement.append(this.nsImageElement,this.nsTextElement),this.nsWindowElement.append(this.nsContentElement),this.nsRootElement.append(this.nsWrapperElement,this.nsWindowElement)}assembleNSComponent(){this.nsRootElement.id=this.getId(),E(this.nsRootElement,"data-ctx","nanosplash"),this.assembleElementStructure(),this.assignCSSClasses()}getId(){return this.id}getText(){return this.nsTextElement.innerText}setText(e){return this.nsTextElement.innerText=e,this}getImgSrc(){return this.imgSrc}setImgSrc(e){return this.nsImageElement.src=e!=null?e:"",this.nsImageElement.style.display=e?"block":"none",this.assembleElementStructure(),this}getDestination(){return this.destinationNode}cleanAndRestore(){const e=this.nsRootElement.parentElement;e&&this.restoreDOMStructure(e)}resetFullscreenAttributes(){E(this.nsRootElement,"style",""),this.nsRootElement.classList.remove("ns-fs")}moveWithRegularStrategy(e){const t=e.parentNode;t&&(this.restoreDOMStructure(t),t.replaceChild(this.nsRootElement,e),this.nsWrapperElement.appendChild(e))}moveWithFullscreenStrategy(){this.nsRootElement.classList.add("ns-fs"),v(this.nsRootElement,document.body,!0)}replaceSplashInstancesHavingSameDestination(e){const t=s=>s.getId()!==this.getId(),n=s=>s.delete();this.nsInstance.getSplashesWithDestinationNode(e).filter(t).forEach(n)}moveTo(e){this.cleanAndRestore(),this.destinationNode=f.destinationToNode(e),this.replaceSplashInstancesHavingSameDestination(this.destinationNode),this.destinationNode===document.body?this.moveWithFullscreenStrategy():(this.resetFullscreenAttributes(),this.moveWithRegularStrategy(this.destinationNode)),this.assembleNSComponent()}forEachWrappedNode(e){Array.from(this.nsWrapperElement.childNodes).forEach(e)}restoreDOMStructure(e){this.forEachWrappedNode(t=>e.insertBefore(t,this.nsRootElement))}removeElementsFromDOM(){[this.nsTextElement,this.nsImageElement,this.nsContentElement,this.nsWrapperElement,this.nsWindowElement,this.nsRootElement].forEach(e=>e.remove())}delete(){this.cleanAndRestore(),this.removeElementsFromDOM(),this.nsInstance.delete(this)}}class l{static ensureInstance(e,t,n,s){var i;return e||(e=new u(t,n,s)),e.setText(n).setImgSrc((i=e.getImgSrc())!=null?i:s)}static createImgFunction(e,t){return n=>(t=l.ensureInstance(t,e,"",n),{show:l.createShowFunction(e,t),progress:l.createProgressFunction(e,t),while:l.createWhileFunction(e,t)})}static createShowFunction(e,t){return n=>(t=l.ensureInstance(t,e,n),e.instances.set(t.getId(),t),t.moveTo(document.body),f.createContextualApiObject(t))}static createProgressFunction(e,t){return(...n)=>(t=l.ensureInstance(t,e,""),t.moveTo(document.body),(async()=>{for(const[s,[i,h]]of n.entries())t.setText(h),await i;t.delete()})(),f.createContextualApiObject(t))}static createWhileFunction(e,t){return n=>(t=l.ensureInstance(t,e,""),{show(s){return e.instances.set(t.getId(),t),t.moveTo(document.body),t.setText(s),n.finally(()=>t.delete()),f.createContextualApiObject(t)}})}}class g{constructor(){this.instances=new Map}img(e){return l.createImgFunction(this,new u(this,"",e))(e)}show(e){return l.createShowFunction(this,new u(this,e))(e)}progress(...e){return l.createProgressFunction(this,new u(this,""))(...e)}while(e){return l.createWhileFunction(this,new u(this,""))(e)}fifoIterate(e){let t=0;const n=this.instances.entries();for(const[s,i]of n)if(!e(s,i,t++))break}delete(e){this.instances.delete(e.getId())}hideAll(){this.instances.forEach(e=>e.delete())}hide(e){if(e){const t=this.instances.get(e);if(t)t.delete();else throw new Error(`Could not find element with id: ${e}`)}else this.fifoIterate((t,n,s)=>{const i=s===0;return i&&n.delete(),i})}getSplashesWithDestinationNode(e){const t=n=>n.getDestination()===e;return Array.from(this.instances.values()).filter(t)}}g.APP_NAME="Nanosplash",window.addEventListener("load",()=>window.ns=new g)})();
