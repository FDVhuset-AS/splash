var t=Object.defineProperty,s=Object.defineProperties,i=Object.getOwnPropertyDescriptors,e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,r=(s,i,e)=>i in s?t(s,i,{t:!0,i:!0,writable:!0,value:e}):s[i]=e;function o(t){return document.querySelector(t)}const a=t=>document.createElement(t);function c(t,...s){t.classList.add(...s)}function l(t,s,i){t.setAttribute(s,i)}class Exception extends Error{constructor(t,s){super(t),this.name=this.constructor.name,this.h=s}}class DestinationException extends Exception{constructor(t,s,i){super(t),this.destination=s,this.h=i}}class IllegalArgumentException extends Exception{constructor(t,s){super(t),this.o=s}}class NanosplashRepository{static l(t){if("string"==typeof t)try{const s=o(t);if(!s)throw new Exception(`No DOM match with ${t}`);return s}catch(s){throw new DestinationException(`Destination (${t}) is either invalid or non-existing in DOM`,t,s)}else if(t instanceof Node)return t;throw new IllegalArgumentException(`Destination (${t}) must be either a Node or a CSS selector`,t)}static u(t){const o={getId:()=>t.getId(),remove:()=>t.delete(),moveTo:s=>t.moveTo(s),getText:()=>t.getText(),setText:s=>t.setText(s),getImgSrc:()=>t.getImgSrc(),setImgSrc:s=>t.setImgSrc(s)};return a=((t,s)=>{for(var i in s||(s={}))n.call(s,i)&&r(t,i,s[i]);if(e)for(var i of e(s))h.call(s,i)&&r(t,i,s[i]);return t})({},o),s(a,i({inside:s=>(t.moveTo(s),o)}));var a}static p(){const t=a("div");return c(t,"ns-spinner"),t.innerHTML='\n            <svg viewBox="0 0 50 50">\n                <circle class="path" cx="25" cy="25" r="20" fill="none"></circle>\n            </svg>\n        ',t}}class SplashInstance{constructor(t,s,i){var e;this.m=a("div"),this.g=a("div"),this.v=a("div"),this.S=NanosplashRepository.p(),this.N=a("div"),this.I=a("div"),this.F=a("div"),this.D=a("img"),this.id=Math.random().toString(36).substring(2),this.O=t,this.g.innerText=s,this.A=i,this.D.src=null!=(e=this.A)?e:"",this.D.alt=p.R,this.m.style.fontSize=t.getFontSize(),this.S.style.display=t.spinnerIsVisible()?"flex":"none",this.j(),this.setImgSrc(i)}T(){c(this.F,"ns-container"),c(this.I,"ns-blur"),c(this.D,"ns-img"),c(this.g,"ns-text"),c(this.v,"ns-text-container"),c(this.S,"ns-spinner"),c(this.N,"ns","ns-window"),c(this.m,"ns-wrapper")}M(){this.v.append(this.g,this.S),this.F.append(this.D,this.v),this.N.append(this.F),this.m.append(this.I,this.N)}j(){this.m.id=this.getId(),l(this.m,"data-ctx","nanosplash"),this.M(),this.T()}getId(){return this.id}getText(){return this.g.innerText}setText(t){return this.g.innerText=t,this}getImgSrc(){return this.A}setImgSrc(t){return this.D.src=null!=t?t:"",this.D.style.display=t?"block":"none",this.M(),this}getDestination(){return this.C}W(){const t=this.m.parentElement;t&&this.$(t)}k(){l(this.m,"style",""),this.m.classList.remove("ns-fs")}B(t){const s=t.parentNode;s&&(this.$(s),s.replaceChild(this.m,t),this.I.appendChild(t))}H(){this.m.classList.add("ns-fs"),((t,s,i=!1)=>{t&&s&&(s.hasChildNodes()&&i?s.insertBefore(t,s.firstChild):s.appendChild(t))})(this.m,document.body,!0)}P(t){this.O.getFromDestinationNode(t).filter((t=>t.getId()!==this.getId())).forEach((t=>t.delete()))}moveTo(t){try{this.W(),this.C=NanosplashRepository.l(t),this.P(this.C),this.C===document.body?this.H():(this.k(),this.B(this.C)),this.j()}catch(t){this.O.debug&&console.warn(t)}}V(t){Array.from(this.I.childNodes).forEach(t)}$(t){this.V((s=>t.insertBefore(s,this.m)))}q(){[this.g,this.S,this.v,this.D,this.F,this.I,this.N,this.m].forEach((t=>t.remove()))}delete(){this.W(),this.q(),this.O.delete(this)}}class NanosplashFactory{static G(t,s,i,e){var n;return t||(t=new SplashInstance(s,i,e)),t.setText(i).setImgSrc(null!=(n=t.getImgSrc())?n:e)}static J(t,s){return i=>(s=NanosplashFactory.G(s,t,i),t.K.set(s.getId(),s),s.moveTo(document.body),NanosplashRepository.u(s))}static L(t,s){return(...i)=>((s=NanosplashFactory.G(s,t,"")).moveTo(document.body),(async()=>{for(const[t,[e,n]]of i.entries())s.setText(n),await e;s.delete()})(),NanosplashRepository.u(s))}static U(t,s){return i=>(s=NanosplashFactory.G(s,t,""),{show:e=>(t.K.set(s.getId(),s),s.moveTo(document.body),s.setText(e),i.finally((()=>s.delete())),NanosplashRepository.u(s))})}}const u=class{constructor(t){var s;this.debug=void 0===(null==t?void 0:t.debug)?u.X:t.Y,this.A=null==t?void 0:t.A,this.Y=void 0===(null==t?void 0:t.Y)?u.Z:t.Y,this.fontSize=null!=(s=null==t?void 0:t.fontSize)?s:"18px",this.K=new Map}setImgSrc(t){return this.A=t,this}showSpinner(t){return this.Y=t,this}setFontSize(t){return this.fontSize=t,this}getImgSrc(){return this.A}spinnerIsVisible(){return this.Y}getFontSize(){return this.fontSize}show(t){return NanosplashFactory.J(this,new SplashInstance(this,t,this.A))(t)}progress(...t){return NanosplashFactory.L(this,new SplashInstance(this,"",this.A))(...t)}while(t){return NanosplashFactory.U(this,new SplashInstance(this,"",this.A))(t)}_(t){const s=this.K.size,i=Array.from(this.K.values());for(let e=s-1;e>=0;e--){const s=i[e];if(!t(s.getId(),s,e))break}}delete(t){this.K.delete(t.getId())}hideAll(){this.K.forEach((t=>t.delete()))}hide(t){if(t){const s=t instanceof Node,i=t=>{Array.from(this.K.values()).filter((s=>s.getDestination()===t)).forEach((t=>t.delete()))};if("string"==typeof t){const s=this.K.get(t);if(s)s.delete();else{const s=o(t);s&&i(s)}}else s&&i(t)}else{const t=this.K.size;this._(((s,i,e)=>{const n=e===t-1;return n&&i.delete(),n}))}}getFromDestinationNode(t){return Array.from(this.K.values()).filter((s=>s.getDestination()===t))}};let p=u;p.R="Nanosplash",p.Z=!0,p.X=!0,module.exports=p;
